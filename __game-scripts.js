var Movement=pc.createScript("playerMovement");Movement.attributes.add("speed",{type:"number",title:"Speed",defaultValue:5}),Movement.attributes.add("jumpForce",{type:"number",title:"Jump Force (Impulse)",defaultValue:400}),Movement.attributes.add("dashForce",{type:"number",title:"Dash Force (Impulse)",defaultValue:500}),Movement.attributes.add("jumpw",{type:"boolean"}),Movement.prototype.initialize=function(){console.log("Player Movement Works!"),this.canjump=!1,this.cameraEntity=this.app.root.findByName("Camera"),this.cameraEntity||console.error("Camera entity named 'Camera' not found! Check entity names."),this.isGrounded=!1,this.canDash=!1,this.lastMoveDirection=new pc.Vec3(0,0,-1),this.entity.rigidbody.on("contact",this.onContact,this),this.app.on("Movement:JumpCoin",this.actvJump,this),this.on("destroy",this.onDestroy,this)},Movement.prototype.onContact=function(e){e.contacts&&e.contacts.length>0&&(e.contacts[0].normal.y>.5&&(this.isGrounded=!0,this.canDash=!0))},Movement.prototype.update=function(e){if(this.cameraEntity&&this.entity.rigidbody){var t=0,i=0;this.app.keyboard.isPressed(pc.KEY_W)&&(i+=1),this.app.keyboard.isPressed(pc.KEY_S)&&(i-=1),this.app.keyboard.isPressed(pc.KEY_A)&&(t-=1),this.app.keyboard.isPressed(pc.KEY_D)&&(t+=1);var s=this.app.gamepads,a=s.getAxis(0,pc.PAD_L_STICK_X),o=s.getAxis(0,pc.PAD_L_STICK_Y);if(void 0!==a&&void 0!==o&&(t+=a,i-=o),this.app.keyboard.isPressed(pc.KEY_SPACE)&&this.isGrounded&&(this.canjump||this.jumpw)&&(this.entity.rigidbody.applyImpulse(0,this.jumpForce,0),this.isGrounded=!1),this.app.gamepads.isPressed(pc.PAD_1,pc.PAD_FACE_1)&&this.isGrounded&&(this.canjump||this.jumpw)&&(this.entity.rigidbody.applyImpulse(0,this.jumpForce,0),this.isGrounded=!1),this.app.keyboard.isPressed(pc.KEY_M)&&this.app.scenes.changeScene("Main Menu"),this.app.gamepads.isPressed(pc.PAD_1,pc.PAD_L_SHOULDER_1)&&this.app.scenes.changeScene("Main Menu"),0!==i||0!==t){var n=this.cameraEntity.forward,p=this.cameraEntity.right;n.y=0,p.y=0,n.normalize(),p.normalize();var r=new pc.Vec3;r.add(n.clone().scale(i)),r.add(p.clone().scale(t)),r.normalize(),this.lastMoveDirection.copy(r),this.entity.rigidbody.applyForce(r.x*this.speed,0,r.z*this.speed)}}},Movement.prototype.actvJump=function(){this.canjump=!0},Movement.prototype.onDestroy=function(){this.app.off("Movement:JumpCoin",this.actvJump,this)};var Coin=pc.createScript("coin");Coin.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onCollision,this)},Coin.prototype.onCollision=function(i){this.app.fire("Overlay:CoinCount"),this.entity.destroy()};var CoinManager=pc.createScript("coinManager");CoinManager.attributes.add("coinEntity",{type:"entity"}),CoinManager.prototype.initialize=function(){this.coinEntity.enabled=!1;for(var t=0;t<1e3;t++){var n=4*Math.random()-4*Math.random(),a=4*Math.random()-4*Math.random(),i=this.coinEntity.clone();i.enabled=!0,i.setPosition(n,1,a),this.entity.addChild(i)}};var Overlay=pc.createScript("overlay");Overlay.attributes.add("coinCountText",{type:"entity"}),Overlay.attributes.add("isLevelExitTrigger",{type:"boolean",default:!1,title:"Is Level Exit Trigger"}),Overlay.attributes.add("level",{type:"number",default:1,title:"Level"}),Overlay.prototype.initialize=function(){this.coinCount=0,this.app.on("Overlay:CoinCount",this.setCoinCount,this),this.app.on("Overlay:SCoinC",this.setSCoin,this),this.on("destroy",this.onDestroy,this)},Overlay.prototype.setCoinCount=function(){this.coinCount++,this.coinCountText.element.text=this.coinCount},Overlay.prototype.update=function(e){1e3==this.coinCount&&this.isLevelExitTrigger&&1==this.level&&this.app.scenes.changeScene("Gaem 2"),10==this.coinCount&&this.isLevelExitTrigger&&2==this.level&&this.app.scenes.changeScene("Gaem 3"),10==this.coinCount&&this.isLevelExitTrigger&&3==this.level&&this.app.scenes.changeScene("Gaem 4"),6==this.coinCount&&this.isLevelExitTrigger&&4==this.level&&this.app.scenes.changeScene("Gaem 5"),5==this.coinCount&&this.isLevelExitTrigger&&5==this.level&&this.app.scenes.changeScene("Gaem 6"),5==this.coinCount&&this.isLevelExitTrigger&&6==this.level&&this.app.scenes.changeScene("Gaem 7"),1==this.coinCount&&this.isLevelExitTrigger&&7==this.level&&this.app.scenes.changeScene("Gaem 8"),1==this.coinCount&&this.isLevelExitTrigger&&8==this.level&&this.app.scenes.changeScene("Gaem 9"),5==this.coinCount&&this.isLevelExitTrigger&&9==this.level&&this.app.scenes.changeScene("Gaem 10"),2==this.coinCount&&this.isLevelExitTrigger&&10==this.level&&this.app.scenes.changeScene("Gaem 11"),1==this.coinCount&&this.isLevelExitTrigger&&11==this.level&&this.app.scenes.changeScene("Gaem 13"),1==this.coinCount&&this.isLevelExitTrigger&&13==this.level&&this.app.scenes.changeScene("Gaem 15"),1==this.coinCount&&this.isLevelExitTrigger&&15==this.level&&6!==this.app.secretCoins&&this.app.scenes.changeScene("Gaem 12"),6==this.app.secretCoins&&15==this.level&&1==this.coinCount&&this.app.scenes.changeScene("Gaem 17"),1==this.coinCount&&this.isLevelExitTrigger&&17==this.level&&this.app.scenes.changeScene("Gaem 16"),1==this.coinCount&&this.isLevelExitTrigger&&16==this.level&&this.app.scenes.changeScene("Gaem 14")},Overlay.prototype.onDestroy=function(){this.app.off("Overlay:CoinCount",this.setCoinCount,this),this.app.off("Overlay:SCoinC",this.setSCoin,this)},Overlay.prototype.setSCoin=function(){this.app.secretCoins+=1};var CameraControl=pc.createScript("cameraControl");CameraControl.attributes.add("targetEntity",{type:"entity",title:"Target Entity (Player Box)",description:"The entity the camera should follow."}),CameraControl.attributes.add("mouseSpeed",{type:"number",default:.1,title:"Mouse Look Speed"}),CameraControl.prototype.initialize=function(){this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this);var t=this.entity.getEulerAngles();this.initialPitch=t.x,this.currentYaw=t.y;var e=this.targetEntity.getPosition(),i=this.entity.getPosition();this.initialWorldOffset=i.clone().sub(e)},CameraControl.prototype.postUpdate=function(t){if(this.targetEntity){this.entity.setEulerAngles(this.initialPitch,this.currentYaw,0);var e=this.initialWorldOffset.length(),i=this.entity.forward.clone().scale(-1),o=this.targetEntity.getPosition().clone().add(i.scale(e));this.entity.setPosition(o)}},CameraControl.prototype.onMouseDown=function(t){0===t.button&&this.app.mouse.enablePointerLock()},CameraControl.prototype.onMouseMove=function(t){pc.Mouse.isPointerLocked()&&(this.currentYaw-=t.dx*this.mouseSpeed)},CameraControl.prototype.update=function(t){if(this.targetEntity){this.entity.setEulerAngles(this.initialPitch,this.currentYaw,0);var e=this.targetEntity.getPosition(),i=this.initialWorldOffset.length(),o=this.entity.forward.clone().scale(-1),n=e.clone().add(o.scale(i));this.entity.setPosition(n);var s=this.app.gamepads.getAxis(0,pc.PAD_R_STICK_X);Math.abs(s)>.1&&(this.currentYaw-=s*this.mouseSpeed*18)}};var Failsafe=pc.createScript("failsafe");Failsafe.attributes.add("level",{type:"number",default:1,title:"Level"}),Failsafe.attributes.add("misc",{type:"boolean"}),Failsafe.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.restart,this)},Failsafe.prototype.restart=function(){1==this.level&&this.app.scenes.changeScene("Gaem"),this.misc?this.app.scenes.changeScene(this.level):this.app.scenes.changeScene("Gaem "+this.level)};var Coin=pc.createScript("coinPower");Coin.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onCollision,this)},Coin.prototype.onCollision=function(i){this.app.fire("Overlay:CoinCount"),this.app.fire("Movement:JumpCoin"),this.entity.destroy()};var PersistEntity=pc.createScript("persistEntity");PersistEntity.prototype.initialize=function(){this.app.root.addChild(this.entity),console.log("Marked MusicManager entity as persistent.")};var SecretCoin=pc.createScript("secretCoin");SecretCoin.prototype.initialize=function(){this.app.secretCoins=0},SecretCoin.prototype.update=function(e){};var Scoin=pc.createScript("scoin");Scoin.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onCollision,this)},Scoin.prototype.onCollision=function(){this.app.fire("Overlay:SCoinC"),this.app.fire("Overlay:CoinCount"),this.entity.destroy()};var FirstPersonMovement=pc.createScript("firstPersonMovement");FirstPersonMovement.attributes.add("camera",{type:"entity",description:"Optional, assign a camera entity, otherwise one is created"}),FirstPersonMovement.attributes.add("power",{type:"number",default:2500,description:"Adjusts the speed of player movement"}),FirstPersonMovement.attributes.add("lookSpeed",{type:"number",default:.25,description:"Adjusts the sensitivity of looking"}),FirstPersonMovement.prototype.initialize=function(){this.isGrounded=!1,this.force=new pc.Vec3,this.eulers=new pc.Vec3,this.app.systems.rigidbody.gravity.set(0,-15,0);var e=this.app;this.entity.rigidbody.on("contact",this.onContact,this),e.mouse.on("mousemove",this._onMouseMove,this),e.mouse.on("mousedown",(function(){e.mouse.enablePointerLock()}),this),this.entity.collision||console.error("First Person Movement script needs to have a 'collision' component"),this.entity.rigidbody&&this.entity.rigidbody.type===pc.BODYTYPE_DYNAMIC||console.error("First Person Movement script needs to have a DYNAMIC 'rigidbody' component")},FirstPersonMovement.prototype.onContact=function(e){this.isGrounded=!0},FirstPersonMovement.prototype.update=function(e){this.camera||this._createCamera();var t=this.force,s=this.app,i=this.camera.forward,o=this.camera.right,r=0,n=0;if((s.keyboard.isPressed(pc.KEY_A)||s.keyboard.isPressed(pc.KEY_Q))&&(r-=o.x,n-=o.z),this.app.keyboard.isPressed(pc.KEY_M)&&this.app.scenes.changeScene("Main Menu"),s.keyboard.isPressed(pc.KEY_D)&&(r+=o.x,n+=o.z),s.keyboard.isPressed(pc.KEY_W)&&(r+=i.x,n+=i.z),s.keyboard.isPressed(pc.KEY_S)&&(r-=i.x,n-=i.z),s.keyboard.isPressed(pc.KEY_SPACE)&&this.isGrounded){const e=this.entity.rigidbody.mass,t=5;this.entity.rigidbody.applyImpulse(0,e*t,0),this.isGrounded=!1}0===r&&0===n||(t.set(r,0,n).normalize().scale(this.power),this.entity.rigidbody.applyForce(t)),this.camera.setLocalEulerAngles(this.eulers.y,this.eulers.x,0)},FirstPersonMovement.prototype._onMouseMove=function(e){(pc.Mouse.isPointerLocked()||e.buttons[0])&&(this.eulers.x-=this.lookSpeed*e.dx,this.eulers.y-=this.lookSpeed*e.dy)},FirstPersonMovement.prototype._createCamera=function(){this.camera=new pc.Entity,this.camera.setName("First Person Camera"),this.camera.addComponent("camera"),this.entity.addChild(this.camera),this.camera.translateLocal(0,.5,0)};var RotatingPlatform=pc.createScript("rotatingPlatform");RotatingPlatform.attributes.add("speed",{type:"number",default:50}),RotatingPlatform.prototype.initialize=function(){},RotatingPlatform.prototype.update=function(t){this.entity.rotate(0,this.speed*t,0)};var Play=pc.createScript("play");Play.attributes.add("Goto",{type:"string"}),Play.prototype.initialize=function(){this.entity.button.on("click",(function(t){this.app.scenes.changeScene(this.Goto)}),this),(this.app.keyboard.isPressed(pc.KEY_SPACE)||this.app.gamepads.isPressed(pc.PAD_1,pc.PAD_FACE_1)&&this.isGrounded&&(this.canjump||this.jumpw))&&this.app.scenes.changeScene(this.Goto)};var Playcontroller=pc.createScript("playcontroller");Playcontroller.prototype.initialize=function(){},Playcontroller.prototype.update=function(e){(this.app.keyboard.isPressed(pc.KEY_SPACE)||this.app.gamepads.isPressed(pc.PAD_1,pc.PAD_FACE_1))&&this.app.scenes.changeScene("Gaem")};var Check=pc.createScript("check");Check.attributes.add("inputEntity",{type:"entity",title:"Text Input Entity"}),Check.prototype.initialize=function(){},Check.prototype.initialize=function(){this.entity.button.on("click",(function(){"INPCCUDEVCPW5"==this.inputEntity.element.text&&this.app.scenes.changeScene("DevMenu")}),this)};var Back=pc.createScript("back");Back.prototype.initialize=function(){},Back.prototype.update=function(e){this.app.keyboard.isPressed(pc.KEY_M)&&this.app.scenes.changeScene("Main Menu"),this.app.gamepads.isPressed(pc.PAD_1,pc.PAD_L_SHOULDER_1)&&this.app.scenes.changeScene("Main Menu")};